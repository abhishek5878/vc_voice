<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up / Log in – Robin.ai – Your calendar, filtered.</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <style>
        .auth-page { max-width: 400px; margin: 2rem auto; padding: 1rem; }
        .auth-page h1 { font-size: 1.25rem; margin-bottom: 1.5rem; }
        .auth-page .tab { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .auth-page .tab button { padding: 0.5rem 1rem; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-secondary); border-radius: var(--radius-sm); cursor: pointer; }
        .auth-page .tab button.active { background: var(--accent); color: #fff; border-color: var(--accent); }
        .auth-page .form-group { margin-bottom: 1rem; }
        .auth-page .form-group label { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; }
        .auth-page .form-group input { width: 100%; padding: 0.5rem; background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); border-radius: var(--radius-sm); }
        .auth-page .error { color: var(--error); font-size: 0.875rem; margin-top: 0.5rem; }
        .auth-page .btn { width: 100%; padding: 0.75rem; margin-top: 0.5rem; cursor: pointer; border-radius: var(--radius-md); font-weight: 500; }
        .auth-page .btn-primary { background: var(--accent); color: #fff; border: none; }
        .auth-page .btn-primary:hover { background: var(--accent-hover); }
        .auth-page .panel { display: none; }
        .auth-page .panel.active { display: block; }
        .auth-page a { color: var(--accent); }
        .auth-page .btn:focus-visible, .auth-page a:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    </style>
</head>
<body>
    <div class="auth-page">
        <h1>Robin.ai</h1>
        <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1.25rem;">Your calendar, filtered.</p>
        <div class="tab">
            <button type="button" id="tab-login" class="active">Log in</button>
            <button type="button" id="tab-register">Sign up</button>
        </div>
        <div id="panel-login" class="panel active">
            <form id="form-login">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required autocomplete="current-password">
                </div>
                <div id="login-error" class="error"></div>
                <button type="submit" class="btn btn-primary">Log in</button>
            </form>
        </div>
        <div id="panel-register" class="panel">
            <form id="form-register">
                <div class="form-group">
                    <label for="register-name">Name (optional)</label>
                    <input type="text" id="register-name" autocomplete="name" placeholder="My Workspace">
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="register-password">Password (min 6)</label>
                    <input type="password" id="register-password" required autocomplete="new-password" minlength="6">
                </div>
                <div id="register-error" class="error"></div>
                <button type="submit" class="btn btn-primary">Sign up</button>
            </form>
        </div>
        <p style="margin-top: 1rem; font-size: 0.875rem;"><a href="/">Back to home</a></p>
    </div>
    <script>
        (function() {
            var API = (window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api');
            function showPanel(name) {
                document.querySelectorAll('.panel').forEach(function(p) { p.classList.remove('active'); });
                document.querySelectorAll('.tab button').forEach(function(b) { b.classList.remove('active'); });
                document.getElementById('panel-' + name).classList.add('active');
                document.getElementById('tab-' + name).classList.add('active');
            }
            document.getElementById('tab-login').addEventListener('click', function() { showPanel('login'); });
            document.getElementById('tab-register').addEventListener('click', function() { showPanel('register'); });

            function saveSession(res) {
                if (res.access_token) {
                    localStorage.setItem('robin_token', res.access_token);
                    if (res.workspace_id) localStorage.setItem('pi_workspace_id', res.workspace_id);
                    window.location.href = '/app';
                }
            }

            document.getElementById('form-login').addEventListener('submit', function(e) {
                e.preventDefault();
                var err = document.getElementById('login-error');
                err.textContent = '';
                fetch(API + '/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('login-email').value.trim(),
                        password: document.getElementById('login-password').value
                    })
                }).then(function(r) { return r.json().then(function(data) { return { ok: r.ok, data: data }; }); })
                  .then(function(o) {
                    if (o.ok) saveSession(o.data);
                    else err.textContent = o.data.error || 'Login failed';
                  }).catch(function() { err.textContent = 'Network error'; });
            });

            document.getElementById('form-register').addEventListener('submit', function(e) {
                e.preventDefault();
                var err = document.getElementById('register-error');
                err.textContent = '';
                fetch(API + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('register-email').value.trim(),
                        password: document.getElementById('register-password').value,
                        name: document.getElementById('register-name').value.trim() || 'My Workspace'
                    })
                }).then(function(r) { return r.json().then(function(data) { return { ok: r.ok, data: data }; }); })
                  .then(function(o) {
                    if (o.ok) saveSession(o.data);
                    else err.textContent = o.data.error || 'Sign up failed';
                  }).catch(function() { err.textContent = 'Network error'; });
            });
        })();
    </script>
</body>
</html>
